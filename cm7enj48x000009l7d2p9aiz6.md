---
title: "Revisiting Why SQLâ€™s Order of Execution Matters"
datePublished: Fri Feb 21 2025 10:52:16 GMT+0000 (Coordinated Universal Time)
cuid: cm7enj48x000009l7d2p9aiz6
slug: revisiting-why-sqls-order-of-execution-matters
cover: https://cdn.hashnode.com/res/hashnode/image/stock/unsplash/hOwcob_3dpc/upload/35a2410e2a39505e1432cb8a7777364f.jpeg
tags: databases, google-cloud, sql, bigquery, data-engineering

---

A few days ago I thought that the following SQL queryÂ would not workâ€” I expected the window function result would be summed multiple times.

ğŸš¨Â Turns out, I was wrong.

This was a great reminder of why understanding SQLâ€™sÂ order of executionÂ is crucial!

I expectedÂ SUM(SUM(val)) OVER (PARTITION BY id)Â toÂ accumulate incorrectly, but SQLâ€™s execution order ensures that:

1ï¸âƒ£ TheÂ GROUP BYÂ clause first aggregatesÂ SUM(val)Â at theÂ id grain.

2ï¸âƒ£ Then, theÂ window functionÂ is applied to the grouped resultâ€”not the raw data. Since thereâ€™s onlyÂ one row per id, the window function correctly returns the expected value.

SQL doesnâ€™t â€œre-sumâ€ the window function like I feared. Instead, it partitions over theÂ already-aggregated valuesâ€”exactly as it should.

ğŸ”Â Have you ever misjudged a queryâ€™s behavior?

![No alt text provided for this image](https://media.licdn.com/dms/image/v2/D4E22AQFbSlouY2_eng/feedshare-shrink_800/B4EZUoFw_jGYAg-/0/1740134355635?e=1743033600&v=beta&t=o7CElWZmK91L8ZF_O7APDU3TjUctBrwXGeikRN8htU8 align="left")

*Found it useful? Subscribe to my Analytics newsletter at* [***notjustsql.com***](https://notjustsql.com/)*.*