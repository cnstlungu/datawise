---
title: "Using LAST_VALUE with STRUCTS"
datePublished: Sun Oct 05 2025 16:27:43 GMT+0000 (Coordinated Universal Time)
cuid: cmgdx1154000002l962hqaixy
slug: using-lastvalue-with-structs
cover: https://cdn.hashnode.com/res/hashnode/image/stock/unsplash/cWMhxNmQVq0/upload/eba4b6c159aeeab4c6938f0727e92a2a.jpeg
tags: analytics, google-cloud, sql, bigquery, data-engineering

---

Even an “empty” STRUCT is still technically something. Not the same as a standalone NULL value.  
  
This is why, if you work with STRUCTs in SQL and try to find the latest non-empty struct using LAST\_VALUE(...) IGNORE NULLS, you’ll notice it doesn’t help — because the struct, even when all fields are null, is still considered non-null.  
  
LAST\_VALUE only skips rows where the entire expression itself is NULL.  
  
To fix this, we can adjust the logic in one of the following ways:  
➡️ Setting the value to NULL when all fields are NULL  
➡️ Using TO\_JSON\_STRING + NULLIF to treat such entries as “null”  
➡️ Using REGEXP\_CONTAINS (thanks ChatGPT) for more dynamic checks  
  
Alternatively, we can just apply LAST\_VALUE separately to each individual field in the struct.  
  
If you're new to STRUCTs, see [one of my previous posts](https://datawise.dev/understanding-structs-in-bigquery).

![graphical user interface, application](https://media.licdn.com/dms/image/v2/D4D22AQFRQqIVwaFuVQ/feedshare-shrink_2048_1536/B4DZm1ITK9KQAw-/0/1759680476934?e=1762387200&v=beta&t=k4hKRptBm4yQ8-97z8qrCMAzxzju2yto0kiendJK9DM align="left")

*Found it useful? Check out to my Analytics newsletter at* [*notjustsql.com*](https://notjustsql.com)*.*